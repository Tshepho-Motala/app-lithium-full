= Get Balance

GGO: `/v1.0/balance` +
Lithium: `CasinoClientService.getPlayerBalance()` +

NOTE: Implemented in link:https://gitlab.com/playsafe/lithium/app-lithium-full/-/blob/develop/service-casino/service-casino-provider-iforium/src/main/java/lithium/service/casino/provider/iforium/controller/BalanceController.java[lithium.service.casino.provider.iforium.controller.BalanceController]

include::plantuml/endpoint-mappings-balance-sequence.puml[]

== Request

[options="header", cols="^.<20m,.<30,.<10,.<20m,.<20e"]
|===
|GGO Parameter|Description|Type|Lithium Parameter|Comments

| Authorization +
_(header)_
| Basic Auth.
| String
| N/A
| Basic YWNtZTphY21lc2VjcmV0

| PlatformKey +
_(body)_
| The platform key associated with the caller.
| String(4)
| N/A
| Validate against config

| Sequence +
_(body)_
| A unique sequence number generated by the Gameflex Operator Wallet API integration.
| String(50)
| N/A
| Ignore

| Timestamp +
_(body)_
| A UTC Timestamp for the request.
| Date
| N/A
| Ignore

| OperatorAccountID +
_(body)_
| Unique identifier for the Player in the Operator Platform.
| String(50)
| User.guid
|

| GameID +
_(body)_
| [red]#*_Optional._*# Unique identifier of the initial Game that is requesting the Balance. Note, this is not sent in all cases.
| String(50)
|
| [red]#*Ignore?*# Do we have any game-specific balances?

| ContentGameProviderID +
_(body)_
| [red]#*_Optional._*# Content Game Provider ID. Note, this is not sent in all cases.
| String(50)
|
| Ignore

|===

.Example Request:
[source,json]
----
{
    PlatformKey: "L100",
    Sequence: "f82f441f-a20f-4244-b760-35d2d05705d7",
    Timestamp: "2020-09-14T13:21:49.9546136Z",
    OperatorAccountID: "TestOperatorAccountID",
    GameID: "11588"
}
----

== Response

[options="header", cols="^.<20m,.<30,.<10,.<20m,.<20e"]
|===
|GGO Parameter|Description|Type|Lithium Parameter|Comments

| ErrorCode
| Error Code.
| Integer
| N/A
| [0, -1, -5, -6]

| Balance.CurrencyCode
| 3-character currency code in ISO 4217 format.
| String(3)
| Domain.currency
|

| Balance.CashFunds
| Cash Funds Balance for the Player to a maximum of 2 decimal places.
| Money
| Balance
|

| Balance.BonusFunds
| [red]#*_Optional._*# Bonus Funds Balance for the Player to a maximum of 2 decimal places when the Player has a bonus in the Operator Wallet.
| Money
| 0.00
| Do we have a Bonus wallet in Lithium? Ignoring for now...

| Balance.FundsPriority
| [red]#*_Optional._*# Value which determines the usage order of funds inside the Operator Wallet.
| String
| Unknown (literal value)
| Do we have a Bonus wallet in Lithium? Ignoring for now...

| Balance.Version
| [red]#*_Optional._*# This is the current version number on the balance inside the Operator Wallet. This can either be a timestamp or auto incremented version number. If the version number will not be used the value should be sent as NULL or omitted from the Json.
| Int64
| N/A
| Omit

|===

.Example Response:
[source,json]
----
{
    ErrorCode: 0,
    Balance: {
        CurrencyCode: "GBP",
        CashFunds: 120.15,
        BonusFunds: 30.1,
        FundsPriority: "Unknown",
        Version: 1234
    }
}
----

== Comments

IMPORTANT: For the UKGC market the BonusFunds.Balance and FundsPriority are required.

TIP: Lithium includes cash bonuses (i.e. no constraints) as a separate balance, which will only exist if there is a playthrough requirement on the bonus. This may lead to unexpected balances when testing. To avoid surprises, it is advisable not to assume that a newly created player has a zero balance and to get the balance prior to performing any action that may impact it e.g. CREATE -> GET BALANCE -> ADD FUNDS -> GET BALANCE.