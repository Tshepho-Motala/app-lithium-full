= Credit Transaction

include::plantuml/endpoint-mappings-credit-sequence.puml[]

GGO: `/v1.0/accounttransaction/credit` +
Lithium: `CasinoClientService.multiBetV1()`

NOTE: Implemented in link:https://gitlab.com/playsafe/lithium/app-lithium-full/-/blob/develop/service-casino/service-casino-provider-iforium/src/main/java/lithium/service/casino/provider/iforium/controller/GameRoundController.java[lithium.service.casino.provider.iforium.controller.GameRoundController]

== Request

[options="header", cols="^.<20m,.<30,.<10,.<20m,.<20e"]
|===
|GGO Parameter|Description|Type|Lithium Parameter|Comments

| Authorization +
_(header)_
| Basic Auth.
| String
| N/A
| Validate against config

| PlatformKey
| The platform key associated with the caller.
| String(4)
| N/A
| Validate against config

| Timestamp
| A UTC Timestamp for the request.
| Date
| BalanceAdjustmentRequest.ExternalTimestamp
| Ignore - issues with unique index in Lithium

| Sequence
| A unique sequence number generated by the Gameflex Operator Wallet API integration.
| String(50)
| N/A
| Ignore

| OperatorAccountID
| Unique identifier for the Player in the Operator Platform.
| String(50)
| BalanceAdjustmentRequest.UserGuid
|

| AccountTransactionID
| Unique numeric ID for the transaction in the Gameflex Platform.
| String(50)
| BalanceAdjustmentComponent.OperatorTransactionReference
|

| AccountTransactionTypeID
| Account Transaction Type that needs to be performed. These are provided in a separate Excel document.
| String(50)
|
| See notes in link:challenge-transaction-types.adoc[Iforium Transaction Types].

| CurrencyCode
| Currency Code of the Transaction.
| String(3)
| BalanceAdjustmentRequest.CurrencyCode
|

| Amount
| Amount to be credited to the Players Authorised Funds in the Operator Wallet.
| Money
| BalanceAdjustmentRequest.BalanceAdjustmentComponent.amount
|

|===

.Example Request:
[source,json]
----
{
    PlatformKey: "L100",
    Sequence: "dec51196-3a6b-4795-8653-1a4c2a6be08e",
    Timestamp: "2020-09-14T14:30:06.2794721Z",
    OperatorAccountID: "TestOperatorAccount",
    AccountTransactionID: "d6637386-c3c4-494f-830d-92223d975f37",
    AccountTransactionTypeID: "13998",
    CurrencyCode: "EUR",
    Amount: 1.23
}
----

== Response

[options="header", cols="^.<20m,.<30,.<10,.<20m,.<20e"]
|===
|GGO Parameter|Description|Type|Lithium Parameter|Comments

| ErrorCode
| Error Code.
| Integer
|
| [0, -1, -5, -6, -7, -9]

| OperatorTransactionReference
| The unique identifier of the Game Round Transaction as assigned by the Operator Platform.
| String(50)
|
|

| Balance
| The Operator Wallet Balance as described in link:endpoint-mappings-gameplay-balance.adoc[Get Balance]. The Operator Waller Balance should always be returned unless a catastrophic error has occurred, and the balance cannot be retrieved.
| Balance Object
|
|

|===

.Example Response:
[source,json]
----
 {
    ErrorCode: 0,
    Result: {
        OperatorTransactionReference: "B111"
    },
    Balance: {
        CurrencyCode: "EUR",
        CashFunds: 210.71,
        BonusFunds: 0,
        FundsPriority: "Unknown",
        Version: 105657
    }
}
----

== Comments

[quote]
--
This method is used to Credit funds to the Player from certain Game Provider promotions e.g. Tournament Wins. Note, that the credit should always be accepted even if the Player is suspended within the Operator Wallet.
--

[IMPORTANT]
--
* The recorded effect for rollbackbet should be `CASINO_ADHOC_CREDIT(EBalanceAdjustmentAccountEffect.CREDIT, false)`
* We can't map `AccountTransactionTypeID` directly to a specific `EBalanceAdjustmentComponentType`. See link:challenge-transaction-types.adoc[Iforium Transaction Types] for more detail.
--
