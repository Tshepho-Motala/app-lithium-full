[plantuml]
----

@startuml
'https://plantuml.com/sequence-diagram

actor DWH as dwh
participant "SVC-LIMIT" as sl
participant "CLIENT-SVC-USER" as csu

||10||

note over dwh, sl: ExternalDwhRestrictionController#lookup

autonumber

dwh -> sl: POST /external/restriction/v1/lookup
    activate sl

    ||10||

    alt Invalid authorization identification
        sl -> sl: validate hash (check if apiAuthorizationId secret key has been configured on application.yml)
        sl --> dwh: Status401UnAuthorisedException

        ||10||
    else Could not calculate hash
        sl -> sl: validate hash
        sl --> dwh: Status500InternalServerErrorException

        ||10||
    else Hash received does not match expected hash
        sl -> sl: validate hash (compares calculated hash and received hash)
        sl --> dwh: Status470HashInvalidException

        ||10||
    end

    ||10||

    alt User Found
        sl -> csu: find user by userGuid
            activate csu

            csu --> sl: return user object

            ||10||

        deactivate csu

    else User Not Found

        sl -> csu: find user by userGuid
            activate csu

            csu --> sl: UserNotFoundException


        deactivate csu

        sl --> dwh: Status404UserNotFoundException

        ||10||

    end

    ||10||

    deactivate csu

    sl -> sl: Find all restrictions loaded on player, that are enabled and has a dwhVisible = true
    sl --> dwh: return a list of player restrictions
deactivate sl
@enduml