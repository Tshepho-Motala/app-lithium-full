<div ng-if="controller.model.current.id != controller.promotionRevision.id" class="panel box box-warning">
	<div class="box-header with-border">
		<h4 class="box-title">You are viewing an older revision of this promotion.</h4>
	</div>
</div>

<div ng-if="controller.model.edit != null" class="panel box box-warning">
	<div class="box-header with-border">
		<h4 class="box-title">{{ 'UI_NETWORK_ADMIN.MISSIONS.MODIFIED.EXPLAIN' | translate: {guid: controller.model.editor.guid} }}</h4>
	</div>
</div>

<div class="row v-reset-row ">
	<div class="col-xs-12">
		<div class="row v-reset-row ">
			<div class="col-xs-7">
				<div class="box box-primary">
					<div class="box-header with-border">
						<h3 class="box-title">{{'UI_NETWORK_ADMIN.MISSIONS.BOXES.MISSIONDETAILS'|translate}}</h3>
					</div>
					<div class="box-body">
						<table class="table table-hover table-striped nowrap" cellspacing="0" width="100%">
						<tbody>
							<tr>
								<th style="width: 30%;">{{'UI_NETWORK_ADMIN.MISSIONS.FIELDS.DOMAIN.NAME'|translate}}</th>
								<td>{{controller.promotionRevision.domain.name}}</td>
							</tr><tr>
								<th>{{'UI_NETWORK_ADMIN.MISSIONS.FIELDS.NAME.NAME'|translate}}</th>
								<td>{{controller.promotionRevision.name}}</td>
							</tr><tr>
								<th>{{'UI_NETWORK_ADMIN.MISSIONS.FIELDS.DESCRIPTION.NAME'|translate}}</th>
								<td>{{controller.promotionRevision.description}}</td>
							</tr>
							<tr ng-hide='controller.promotionRevision.sequenceNumber == null'>
								<th>{{'UI_NETWORK_ADMIN.MISSIONS.FIELDS.SEQUENCENUMBER.NAME'|translate}}</th>
								<td>{{controller.promotionRevision.sequenceNumber}}</td>
							</tr><tr>
								<th>{{'UI_NETWORK_ADMIN.MISSIONS.FIELDS.STARTDATE.NAME'|translate}}</th>
								<td>{{controller.promotionRevision.startDate|datetimedefault}}</td>
							</tr><tr>
								<th>{{'UI_NETWORK_ADMIN.MISSIONS.FIELDS.ENDDATE.NAME'|translate}}</th>
								<td>{{controller.promotionRevision.endDate|datetimedefault}}</td>
							</tr><tr>
								<th>{{'UI_NETWORK_ADMIN.MISSIONS.FIELDS.XPLEVEL.NAME'|translate}}</th>
								<td>{{controller.promotionRevision.xpLevel}}</td>
							</tr><tr>
								<th>{{'UI_NETWORK_ADMIN.PROMOTIONS.FIELDS.MAXREDEEMABLE.NAME'|translate}}</th>
								<td ng-if="controller.promotionRevision.maxRedeemable > 1">{{controller.promotionRevision.maxRedeemable}}&nbsp;{{ "UI_NETWORK_ADMIN.BONUS.MAXREDEEMABLE.TIMES" | translate }}&nbsp;{{controller.maxRedeemableGranularity | translate}}</td>
								<td ng-if="controller.promotionRevision.maxRedeemable == 1">{{ "UI_NETWORK_ADMIN.BONUS.MAXREDEEMABLE.ONCE" | translate }}&nbsp;{{controller.maxRedeemableGranularity | translate}}</td>
							</tr><tr>
								<th>{{'UI_NETWORK_ADMIN.PROMOTIONS.FIELDS.DURATION.NAME'|translate}}</th>
								<td>{{ controller.getDurationExplanation()}} </td>
							</tr><tr>
								<th>{{'UI_NETWORK_ADMIN.PROMOTIONS.FIELDS.GRANULARITYSTARTOFFSET.NAME'|translate}}</th>
								<td><strong>{{controller.promotionRevision.granularityStartOffset}}</strong> - {{ controller.getOffsetExplanation() }}</td>
							</tr>
							<tr ng-show='controller.promotionRevision.sequenceNumber !== null'>
								<th>{{'UI_NETWORK_ADMIN.PROMOTIONS.FIELDS.GRANULARITYBREAK.NAME'|translate}}</th>
								<td>
									<strong>{{ controller.promotionRevision.granularityBreak }}</strong> - {{controller.getBreakExplanation()}}
								</td>
							</tr>
						</tbody>
						</table>	
					</div>
				</div>
			</div> 
			<div class="col-xs-5">
				<div class="box box-primary">
					<div class="box-header with-border">
						<h3 class="box-title">{{'UI_NETWORK_ADMIN.MISSIONS.BOXES.MISSIONREWARD'|translate}}</h3>
					</div>
					<div class="box-body">
						<table class="table table-hover table-striped nowrap" cellspacing="0" width="100%">
						<tbody>
							<tr>
								<th style="width: 30%;">{{'UI_NETWORK_ADMIN.MISSIONS.FIELDS.MISSIONREWARD.NAME'|translate}}</th>
								<td>
									<span class="label label-success" ng-if="controller.promotionRevision.reward && controller.promotionRevision.reward.bonusCode">{{controller.promotionRevision.reward.bonusCode}}</span>
									<span class="label label-danger" ng-if="!controller.promotionRevision.reward || !controller.promotionRevision.reward.bonusCode">NONE</span>
								</td>
							</tr>
						</tbody>
						</table>
					</div>
				</div>
			</div>

			<div class="col-xs-5">
				<promotion-user-category promotion-revision="controller.model.current"/>
			</div>
		</div>
			
		<div class="row v-reset-row ">
			<div class="col-xs-12">
				<div class="box box-primary">
					<div class="box-header with-border">
						<h3 class="box-title">{{'UI_NETWORK_ADMIN.MISSIONS.BOXES.MISSIONCHALLENGES'|translate}}</h3>
					</div>
					<div class="box-body">
						<div class="col-xs-12">
							<div ng-if="controller.model.current.challenges.length === 0">
								<div class="card-danger-shadow">
									<div class="card card-block">
										<span class="description" align="center">
											{{'UI_NETWORK_ADMIN.MISSIONS.FIELDS.CHALLENGE.NOTSETUP'|translate}}
										</span>
									</div>
								</div>
								<br/>
							</div>
							<div ui-tree ng-if="controller.promotionRevision.challenges.length > 0" data-max-depth="1">
								<ol ui-tree-nodes ng-model="controller.promotionRevision.challenges" class="">
									<li ui-tree-node ng-repeat="challenge in controller.promotionRevision.challenges" style="padding-bottom: 4px;">
										<div class="row v-reset-row " style="margin-bottom: 5px;">
											<div class="card card-block">
												<div class="d-flex justify-content-start" ng-click="controller.collapseChallenge(challenge)">
													<div class="p-2">
														<i class="fa fa-chevron-up" ng-show="challenge.collapsed"></i>
														<i class="fa fa-chevron-down" ng-show="!challenge.collapsed"></i>
													</div>
													<div class="divider"></div>
													<div class="p-2">
														<div class="user-block">
															<a ng-click="controller.openLightBox(challenge.iconUrl);$event.stopPropagation();">
																<img class="img-circle img-bordered-sm" ng-src="{{challenge.iconUrl}}" src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" alt="">
															</a>
														</div>
													</div>
													<div class="p-2">
														<span class="badge-wrap card-success" ng-if="challenge.reward.bonusCode">{{'UI_NETWORK_ADMIN.MISSIONS.FIELDS.CHALLENGE.CHALLENGEREWARD.REWARDLABEL'|translate: {challengeReward: challenge.reward.bonusCode} }}</span>
													<span class="badge-wrap card-danger" ng-if="!challenge.reward.bonusCode">{{'UI_NETWORK_ADMIN.MISSIONS.FIELDS.CHALLENGE.CHALLENGEREWARD.NOTSETUPLABEL'|translate}}</span>
													<br/>
													<span class="badge-wrap card-success" ng-if="challenge.rules && challenge.rules.length > 0">{{'UI_NETWORK_ADMIN.MISSIONS.FIELDS.CHALLENGE.CHALLENGERULES.RULESLABEL'|translate: {rules: challenge.rules.length} }}</span>
													<span class="badge-wrap card-danger" ng-if="!challenge.rules || challenge.rules.length === 0">{{'UI_NETWORK_ADMIN.MISSIONS.FIELDS.CHALLENGE.CHALLENGERULES.NOTSETUPLABEL'|translate}}</span>
													</div>
													<div class="p-2">
														<span class="description">
															{{challenge.description}}
														</span>
													</div>
												</div>
												<div uib-collapse="!challenge.collapsed" class="panel-collapse collapse">
													<div class="card-content">
														<hr/>
														<div style="text-align: center;" class="card-outline-warning" ng-if="challenge.rules.length === 0">{{'UI_NETWORK_ADMIN.MISSIONS.FIELDS.CHALLENGE.CHALLENGERULES.NOTSETUP'|translate}}</div>
														<div class="card card-block" style="margin-bottom: 5px;" ng-repeat="rule in challenge.rules">
															<table class="table table-hover table-striped nowrap" cellspacing="0" width="100%">
															<tbody>
															<tr>
																<th style="width: 10%;">{{'UI_NETWORK_ADMIN.MISSIONS.FIELDS.CHALLENGE.CHALLENGERULES.RULE.TYPE'|translate}}</th>
																<td>{{rule.type}}</td>
															</tr><tr>
																<th>{{'UI_NETWORK_ADMIN.MISSIONS.FIELDS.CHALLENGE.CHALLENGERULES.RULE.ACTION'|translate}}</th>
																<td>{{rule.action}}</td>
															</tr><tr>
																<th>{{'UI_NETWORK_ADMIN.MISSIONS.FIELDS.CHALLENGE.CHALLENGERULES.RULE.VALUE'|translate}}</th>
																<td>{{rule.value}}</td>
															</tr>
															<tr>
																<th>{{'UI_NETWORK_ADMIN.MISSIONS.FIELDS.CHALLENGE.CHALLENGERULES.RULE.EXPLANATION'|translate}}</th>
																<td>
																	<span class="label label-primary" style="font-size: 10pt;">{{controller.getChallengeRuleExplanation(rule.type, rule.action, rule.identifier, rule.value) | translate: { val: rule.value, gameName: controller.getGameName(rule.identifier) } }}</span>
																</td>
															</tr>
															</tbody>
															</table>
														</div>
													</div>
												</div>
											</div>
										</div>
									</li>
								</ol>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	
<!-- 			<pre>{{controller.model|json}}</pre> -->
	</div>
</div>
